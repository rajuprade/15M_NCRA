            t filenm
            b same
            :filenm
            s%^\([^:]*\)\(:.*\)%\1/\
\1\2%
            s%\(\n\)%\1#%g
            s%\(\n\)#%\1 %
            s%/%/#%g
            :field
               s%^[^/][^/]*/#\(.*\)\(\n \)%\1../\2%
            t field
            s%/#%/%g
            s%^\(.*\)\(\n\) \(.*\)$%\3\2#\1%
            s%\(\n\)#%\1%g
            :prefix
               s%^\(.*<\n*[ 	]*[aA][ 	]\n*[^>]*[hH][rR][eE][fF]\n*[ 	]*=\n*[ 	]*"\)\([^ 	"/]*\.htx/[^ 	"]*#xref_[^  "]*"[^>]*>.*\)\(\n\(.*\)\)%\1\4\2\3%
            t prefix
            s%^\(.*\)\n.*%\1%
            :same
         }
      }
      t mark
      : mark
      s%\(\n\)%\1#%g
      t newline
      p
      d
      :newline
          s%\(\n\)#%\1 %
          s%^\(\([^:]*:\).*\n \)%\1\2%
          P
          s%.*\n %%
      t newline
